# Overview
The Editor is a content creation tool for the CMS Architecture.  The Editor currently creates posts,edits, saves posts and publishes posts as core functionaility.

# Updates
The next version will need to integrate with the Workflow Service app that manages the meta-data and release process for new posts.  The Workflow application is a separate application in cms-orch project and is not part of the Editor application.  The Editor will need to be able to load the meta-data from the Workflow Service app after a post is published.  The meta-data is stored in an S3 bucket and is available via a REST API.  The Editor will need to poll the Workflow Service app for the meta-data after a post is published.

# Requirements
- [ ] The Editor needs to load the Meta-data from the Workflow Service app, after publishing.
  - The meta-data is asynchronous and will be loaded after the post is published but may not be available immediately.
  - The Editor will need to poll the Workflow Service app for the meta-data.
  - The Workflow Application publishes the meta-data to an S3 bucket available as a REST API.
  - The Editor will need to use the S3 REST API to retrieve the meta-data.
  - The Editor will need to handle the case where the meta-data is not available immediately and retry after a delay.
  - The Editor will need to handle the case where the meta-data is not available after a certain number of retries and notify the user.
  - The Editor will need to handle the case where the meta-data is available and update the post with the meta-data.
- The meta-data has two release states: 
  - Published: This is the state of the post before it is released.   
  - Released: This is the state of the post after it is released.
- The Meta-data key in S3 is the post id.  The S3 REST would like this:
  - `https://<bucket-name>.s3.amazonaws.com/1828dndn-12b0-4129-940d-77ee4008339c.json`
- Preview URI is the URI to the preview of the post in the CMS for Publish State.
- Released Meta-data is the meta-data that is available after the post is released.
- Releasing a post is sending an AWS Event to an Event Bus.  
- Source is defined as the Editor Saved Post Key in the S3 bucket.
- Here is the data shape for the event to send on Release:
```json
{
  "version": "0", //Generated by Event Bridge API
  "id": "55043351-f8f2-8b44-1bd9-2d18186dc755",//Generated by Event Bridge API
  "detail-type": "content-changes",// Use this for all Messages
  "source": "content.published", //This is provided via Configuration since Source is used to route events in the Event Bridge API
  "account": "829043575575",//Generated by Event Bridge API
  "time": "2025-02-19T02:22:41Z",//Generated by Event Bridge API
  "region": "us-east-1",//Generated by Event Bridge API
  "resources": [],
  "detail": {
    "post_id": "1828dndn-12b0-4129-940d-77ee4008339c", // This is the post ID of the post being released.  This is the same UUID used in saving a post
    "post_key": "ready-to-publish/Lab12.98bf13ec-12b0-4129-940d-77ee4008339c.json",  // This is the key of the post in the S3 bucket
    "post_srcVersion": "Gb5OTgYmGpUrcu2SYek_dMsIHGEyI.vh", // This is the version of the post in the S3 bucket
    "post_srcKey": "stage/Lab12.d19136c8-a4e0-4573-9463-c39e8ef5200e.json", // This is the source key of the post in the S3 bucket
    "post_uri": "/#/post/%2Fdata%2Fcatalog%2Fcontent%2FLab12.98bf13ec-12b0-4129-940d-77ee4008339c.null", // This is the URI to the post in the CMS
    "post_state": "preview", // This is the state of the post being released.  Valid values - [preview, published]
    "source": "content.published"
  }
}
```

- The Editor will need to handle the case where the post is released and update the post with the released meta-data.-
- Full meta-data is provided below as an example includes preview and published data states.:
```json
{
  "postKey": "Lab12",
  "src": "stage/Lab12.1828dndn-12b0-4129-940d-77ee4008339c.json",
  "published_data": {
    "id": "1fd19540-d98e-4dc2-97cd-574455873d29", //Published Unique ID
    "key": "published/1828dndn-12b0-4129-940d-77ee4008339c_Lab12_1fd19540-d98e-4dc2-97cd-574455873d29.json"
  },
  "published": true,
  "source": {
    "key":  "ready-to-publish/Lab12.98bf13ec-12b0-4129-940d-77ee4008339c.json"
  },
  "preview": {
    "catalogEntryUri": "/#/post/%2Fdata%2Fcatalog%2Fcontent%2Fbasic_media_post.e39f6766-a5c5-4b03-8981-85b8d02553cf.Gb5OTgYmGpUrcu2SYek_dMsIHGEyI.vh"
  },
  "released": true,
  "release": {
    "catalogEntryUri": "/#/post/%2Fdata%2Fcatalog%2Fcontent%2F1828dndn-12b0-4129-940d-77ee4008339c_Lab12_1fd19540-d98e-4dc2-97cd-574455873d29.json",
    "source": "ready-to-publish/Lab12.98bf13ec-12b0-4129-940d-77ee4008339c.json"
  },
  "preview_event": {
    "post_id": "1828dndn-12b0-4129-940d-77ee4008339c", 
    "post_key": "ready-to-publish/Lab12.98bf13ec-12b0-4129-940d-77ee4008339c.json", 
    "post_srcVersion": "Gb5OTgYmGpUrcu2SYek_dMsIHGEyI.vh", 
    "post_srcKey": "stage/Lab12.d19136c8-a4e0-4573-9463-c39e8ef5200e.json", 
    "post_uri": "/#/post/%2Fdata%2Fcatalog%2Fcontent%2Fbasic_media_post.e39f6766-a5c5-4b03-8981-85b8d02553cf.Gb5OTgYmGpUrcu2SYek_dMsIHGEyI.vh", 
    "post_state": "preview", 
    "source": "content.published"
  },
  "published_event": {
    "post_id": "1828dndn-12b0-4129-940d-77ee4008339c",
    "post_key": "ready-to-publish/Lab12.98bf13ec-12b0-4129-940d-77ee4008339c.json",
    "post_srcVersion": "Gb5OTgYmGpUrcu2SYek_dMsIHGEyI.vh",
    "post_srcKey": "stage/Lab12.d19136c8-a4e0-4573-9463-c39e8ef5200e.json",
    "post_uri": "/#/post/%2Fdata%2Fcatalog%2Fcontent%2Fbasic_media_post.e39f6766-a5c5-4b03-8981-85b8d02553cf.Gb5OTgYmGpUrcu2SYek_dMsIHGEyI.vh",
    "post_state": "publish",
    "source": "content.released"
  }
} 
```

# Acceptance Criteria
- [x] The Editor can load the meta-data from the Workflow Service app after publishing.
- [x] The Editor can poll the Workflow Service app for the meta-data.
- [x] The Editor can retrieve the meta-data from the S3 REST API.
- [x] The Editor can handle the case where the meta-data is not available immediately and retry after a delay.
- [x] The Editor can handle the case where the meta-data is not available after a certain number of retries and notify the user.
- [x] Test cases are updated and pasted for the new functionality.
